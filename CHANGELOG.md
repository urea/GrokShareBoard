# 更新履歴

## [1.5.4] - 2026-02-22

### 新機能・UI改善
- **サムネイル右上への動画アイコン（再生マーク）表示の復活**:
  事前存在チェック廃止に伴い「`_thumbnail.jpg` を持つデータは全て動画である」という法則性が生まれたため、動画アイコン表示の仕様を復活させました。サムネイル画像の右上に「Playアイコン」が配置されるようになり、再生可能な動画であるか静止画であるかが一覧画面から一目で判別できるようになりました。

## [1.5.3] - 2026-02-22

### 修正・パフォーマンス改善
- **動画存在確認チェックの廃止とスリム化（高速化）**:
  URL登録時（Load時）に裏側で行っていた動画（MP4）ファイルの存在チェック処理を完全に廃止しました。GrokのCDN（Cloudflare等）によるアクセス制限（403エラー）や3秒のタイムアウトによって、実際には存在する動画が「存在しない」と誤判定されてしまう致命的な不具合を解消するためです。今後はURLフォーマットから無条件に `video_url` を組み立てて即DBへ登録するようにしたため、不具合解消と同時にロード時の謎の待ち時間（3秒〜5秒）が消滅し、爆速で読み込めるようになりました。

## [1.5.2] - 2026-02-21

### 修正
- **URLから不要なクエリパラメータ（?以降）を除去する処理の徹底（バグ修正）**:
  これまで、エラー時の画像再リトライ処理等で付与されたキャッシュ回避用のパラメータ（`?t=...`）や、URLペースト時のトラッキングパラメータ（`?source=...`）が、正しく切り離されずにそのままデータベースへ保存されてしまう不具合がありました。今回、DBへ保存（Insert/Update）する直前のすべての抽出ロジックにおいて、確実に `?` 以降の文字列を切り捨てるよう修正し、常にクリーンな純正規URLのみが保存されるように改善しました。（※すでにDBに入ってしまっているゴミデータについては、別記のSQLパッチにより一括修正済みです）

## [1.5.1] - 2026-02-21

### 機能追加・改善
- **スマホ向けスワイプ操作とナビゲーション**:
  全画面プレビュー中、左右キー入力による前後の作品への遷移機能を追加しました。さらに、スマートフォン向けに画面を左右にスワイプすることでの遷移や、画面端の「〈 〉」ボタンの常時表示など、タッチデバイスでもサクサク閲覧できるよう操作性を向上させました。

## [1.5.0] - 2026-02-21

### 新機能・大幅な体験向上（UI / UX）
- **同一画面でのシームレスな動画プレビュー（モーダル再生）**:
  これまで動画を見るために別タブでGrok本体のページを開く必要がありましたが、サムネイルをクリックするだけで同一画面内に全画面モーダルプレイヤーが立ち上がり、即座に動画が自動再生されるようになりました。画像のみの投稿の場合は、高画質画像が拡大表示されます。
- **UIの大幅な整理と目的の分離**:
  「動画（画像）をプレビューする操作」と「元のGrokページへ遷移する操作」を明確に切り分けました。
  - サムネイル画像全体をプレビュー専用のクリック領域に変更。
  - カード下部および詳細モーダル内に、遷移専用の「Grok」別タブリンクボタン（アイコン付き）を新設。
- **「視聴回数（Views）」の独立カウントと表示**:
  Grokページへ直接遷移した回数「Clicks」とは別に、サイト内でモーダルプレビューを開いた回数を「Views」として独立して保存・カウントアップ・表示する機能を追加しました。
- **視聴回数（Views）順ソート機能**:
  画面上部のタブから、これまでの「人気（Clicks）」順に加えて「視聴回数（Views）」順での並び替えに対応しました。

### 改善・修正
- **UIのガタツキ修正**:
  カード下部にある各種ボタン群（詳細、Grokリンク）およびインジケーター（コメント数、視聴回数、クリック数）の高さ・整列を完全な直線になるよう精密に調整しました。
- **ESCキーでのモーダルクローズ**:
  動画プレビューおよび詳細・コメントモーダルを開いている間、キーボードの「ESCキー」を押すことで即座に枠を閉じられるように操作性を改善しました。

## [1.4.12] - 2026-02-20

### 内部改善（マイグレーション）
- **DB主キー（ID）のGrokネイティブ化**: これまでSupabase側で自動生成していた独自のランダムUUID（`id`）を廃止し、GrokURL内に含まれるネイティブのUUID（`https://grok.com/imagine/post/[UUID]`）をそのままDBの主キー（Primary Key）として採用するアーキテクチャに変更しました。
  これにより、データベースレベルでの物理的なURL重複登録が完全にブロックされるようになり、将来的な外部API等とのデータ紐付けも容易になりました。（※既存の90件以上のデータとコメント紐付けについても、無停止で新IDへの移行スクリプトを実行完了しています）

## [1.4.11] - 2026-02-20

### バグ修正・安定性向上
- **静止画（動画なし）のエラーと無限ループを修正**: 「静止画のみ」のGrok投稿において、画像が `/share-images/[UUID].jpg` に保存される仕様に対応しました。新規Load時に動画がないと判定された場合は自動的にこのパスをDBに登録し、既存の異常データへの読み込みリトライ時にもこのパスを優先して探すようにフォールバック（自動復旧）処理を強化しました。また、すべての画像パスが見つからない場合に発生していたブラウザの無限リトライバグを解消し、正しく安全に「Preview Unavailable」となるように修正しました。

## [1.4.10] - 2026-02-20

### 修正
- **画像URLのクリーンアップ化**: プレビュー画像のURL（`image_url`）にも画像ローティング時のキャッシュバスター（`?t=...`）等のパラメータが混入してしまう問題を発見し、DB保存時にクエリパラメータを完全に除去した正規URLのみを保存するように修正しました。（既存DBレコード64件も同時に修正済み）

## [1.4.9] - 2026-02-20

### 追加・変更
- **URL自動補正（正規化）**: 共有URLを入力・ペーストした際に、余分なトラッキングパラメータ（`?source=...` 等）を自動的に除去し、クリーンなURL（`https://grok.com/imagine/post/[UUID]`）として扱うように改善しました。これにより、不要なURLの肥大化やDB内での同一画像の重複登録を防ぎます。

## [1.4.8] - 2026-02-20

### 変更
- **SEOメタデータの日本語化**: 検索結果（Google等）やSNSシェア時に表示されるサイトの説明文（description）を英語から日本語に変更し、日本のユーザーにサイトの目的が正しく伝わるように改善しました。

## [1.4.7] - 2026-02-20

### 修正
- **自動翻訳ポップアップの抑制**: HTMLのルート言語指定を `lang="en"` から `lang="ja"` に修正し、Chrome拡張のGoogle Translate等が誤って英語サイトと判定し自動で翻訳提案を出してくる問題を解決しました。

## [1.3.2] - 2026-02-19

### 修正
- **UI Unification**: 投稿カード上のボタン文言を「詳細・コメント / Details」に統一しました。プロンプトの有無に関わらず、詳細とコメントの両方にアクセスできることが明確になりました。

## [1.4.6] - 2026-02-19

### 修正
- **プレビュー表示メッセージの適正化**: プレビュー未生成時の表現を「エラー」から「準備中」に、また「生成待ち」から「ユーザー操作によるトリガーが必要」という正確な説明に修正しました。アイコンも警告から時計マークに変更しています。

## [1.4.5] - 2026-02-19

### 修正
- **プレビュー画像特定ロジックの完全復元**: 以前のバージョンで磨き上げた「高度な画像特定・リトライロジック」がリファクタリングの影響で失われていたため、完全に復元しました。
    - **フォールバック強化**: `_thumbnail.jpg` → `.png` → `/images/[UUID].jpg` の順で最適な画像を自動特定します。
    - **リトライの適正化**: 「再読み込み」時に不正規なURLではなく、必ず正規のサムネイルURLから再試行するように修正しました。

## [1.4.4] - 2026-02-19

### 修正
- **プレビュー表示のデグレ修正**: プレビュー画像の読み込みに失敗した際、詳細な説明と「元ページ確認」「再読み込み試行」ボタンが正しく表示されない不具合を修正しました。

## [1.4.3] - 2026-02-19

### 変更
- **投稿後の自動ソート**: どのソート順（人気順など）で閲覧していても、投稿成功時に自動的に「最新 / Newest」へ切り替わるようにしました。これにより、投稿が正しく反映されたことを即座に確認できます。

## [1.4.2] - 2026-02-19

### 変更
- **投稿入力フローの改善**: URLをロード（解析）する前でも、プロンプト・説明やNSFW設定を入力できるようになりました。
- **入力保護**: ロード実行時、新規投稿の場合にユーザーがすでに入力していたコメントが消えないように修正しました。

## [1.4.1] - 2026-02-19

## [1.3.1] - 2026-02-19

## [1.3.0] - 2026-02-19

### 追加
- **コメント機能**: 各投稿に対して匿名でコメントを投稿・閲覧できるようになりました。
- **匿名コメント**: 名前入力は不要で、ブラウザごとの匿名ID (`client_id`) を利用します。
- **管理者用コメント管理**: 管理者モードにて、不適切なコメントを1クリックで削除可能です。


## [1.2.2] - 2026-02-19

### 修正
- **UI Layout Fix**: ヘッダー（タイトルバー）の固定表示（Sticky）を解除し、元のスクロール追従しない形式に戻しました。

## [1.2.1] - 2026-02-19

## [1.2.0] - 2026-02-19

### 追加
- **SFW/NSFW表示切り替え機能**: ヘッダーに表示モードを切り替えるトグルボタンを実装しました。初期表示は SFW モードとなり、安全な閲覧環境を提供します。
- **NSFWフラグ導入**: 投稿時に「NSFW作品として投稿」を選択できるようになりました。
- **管理者モード (隠し機能)**: 管理者向けの秘密の操作により、管理者モードのON/OFFが可能になりました。
- **管理者専用UI**: 管理者モード中、各投稿カード上に NSFW フラグを直接切り替えられる管理用ボタンが表示されます。

### 変更
- **Persistence**: ユーザーの SFW/NSFW 表示設定がブラウザの `localStorage` に保存され、再訪時にも維持されるようになりました。


## [1.1.26] - 2026-02-17

### 追加
- **Sorting functionality**: 「最新 / Newest」と「人気 / Popular」の切り替え機能を実装しました。検索結果内での絞り込みにも対応しています。

### 変更
- **Policy Update**: 運用方針を「自薦他薦不問・ジャンル制限なし」と明文化し、プロンプトのアイディア保管庫としての役割を強化しました。
- **Language Order Unification**: サイト内の日英併記の順序を「日本語 / English」に統一し、日本語ユーザーにとっての視認性を向上させました。
- **UI Simplification**: `Close` / `Copy` / `Load` など、単独で意味が伝わるボタンの表記を簡略化し、デザインをスッキリさせました。

### 修正
- **Click Count Display Fix**: プロンプトがない投稿において、クリック数（閲覧数）が表示されない不具合を修正しました。
- **Race Condition Fix**: ソート切り替え時に「Loading」状態が解除されなくなる競合状態を解消しました。
- **Build Error Fix**: ステート定義の不足によるビルドエラーを修正しました。

## [1.1.23] - 2026-02-16

### 変更
- **UI Refinement**: 動画投稿を示す右上の「再生アイコン」を廃止しました。情報の不正確さを排除し、ホバーした際に自然に動画が動き出す、よりシームレスでフラットな体験へと調整しました。

## [1.1.22] - 2026-02-16

### 修正
- **Video Detection**: 静止画の投稿に対しても再生ボタンが表示されてしまう問題を修正しました。投稿時に動画の有無を自動判別し、正しいインジケーターのみを表示するように改善されています。また、既存の誤ったデータに対しても、読み込み失敗時にアイコンを非表示にするフォールバックを追加しました。

## [1.1.21] - 2026-02-16

### 新機能
- **Click Count Display**: 各個別に集計されているクリック数（閲覧数）を、カード上に表示するようにしました。どの投稿が注目されているか一目でわかります。

## [1.1.20] - 2026-02-16

### 新機能
- **Click Tracking**: 各投稿のカードがクリック（閲覧のために元サイトへ移動）された回数を記録するようにしました。これにより、どの投稿が人気かを計測できるようになります。

## [1.1.19] - 2026-02-16

### 復活・改善
- **Hover Autoplay**: 動画投稿にマウスをホバーした際、自動的にミュート再生する機能を再実装しました。これにより、クリックすることなく動画の内容をクイックに確認できます。

## [1.1.18] - 2026-02-16

### 改善
- **Layout Refinement**: 無駄な余白を削減するため、投稿エリアを再度折りたたみ形式（details）に戻しました。
- **UX Improvement**: 「投稿はこちら」という説明をヘッダーに追加し、クリックして入力フォームを開く必要があることをより明確にしました。

## [1.1.17] - 2026-02-16

### 改善
- **Layout Update**: 投稿フォームを常に表示されるように変更しました（これまではガイド内に格納）。これにより、サイト訪問後の「何をしていいかわからない」という迷いを解消します。
- **Help Section**: 使い方や規約を独立した折りたたみセクションに移動しました。

## [1.1.16] - 2026-02-16

### 修正
- **Deploy Fix**: v1.1.15で反映されなかったボタンデザインの変更 (`ShareInput.tsx`) を確実に適用して再リリース。

## [1.1.15] - 2026-02-16

### 改善
- **UI Update**: 編集モード時の「削除」「キャンセル」ボタンのスタイルを更新しました。テキストリンク形式から「更新」ボタンと同様のソリッドなボタンスタイルに変更し、視認性と操作性を統一しました（削除＝赤、キャンセル＝グレー）。

## [1.1.14] - 2026-02-16

### 改善
- **Grid Layout**: 投稿一覧のレイアウトを「Masonry (縦並び)」から「Grid (左→右の順)」に変更しました。これにより、投稿順序が視覚的に分かりやすくなり、不自然な改行や空白が解消されます。また、ワイド画面向けに調整を行いました。

## [1.1.13] - 2026-02-16

### 修正
- **Syntax Fix**: `ShareInput.tsx` のJSX記述エラーを修正。これにより、v1.1.11で意図した「プレビュー説明UI」が正常に表示されるようになります。

## [1.1.12] - 2026-02-16

### 修正
- **Deploy Fix**: v1.1.11で反映されなかったUI変更 (`ShareInput.tsx`) を確実に適用して再リリース。

## [1.1.11] - 2026-02-16

### 改善
- **Preview UI Refresh**: プレビュー未生成時の表示を「エラー(Unavailable)」から「手順案内(Pending)」に変更しました。「1. 元ページを開く」→「2. 再読み込み」という手順を明示し、ユーザーが迷わず操作できるようにしました。

## [1.1.10] - 2026-02-16

### 修正
- **Retry Logic Fix**: 「Retry Image」ボタンが、失敗した最後の画像URL（例: .jpg）をリトライしてしまう問題を修正。再試行時には必ず正規のサムネイルURL (`_thumbnail.jpg`) にリセットしてからロードするように変更しました。

## [1.1.9] - 2026-02-16

### 修正
- **Build Fix**: v1.1.8で誤って削除してしまったアイコン (`Sparkles`, `Trash2`, `RefreshCw`) のインポートを復元しました。

## [1.1.8] - 2026-02-16

### 追加
- **Retry Preview**: 投稿プレビューで画像読み込みに失敗した場合に、再読み込みを試行できる「Retry Image」ボタンを追加しました。Grokの仕様（初回アクセス時にサムネイル生成）に対応するためです。

## [1.1.7] - 2026-02-16

### 追加
- **Copy Button**: プロンプト全文表示モーダルに、テキストをクリップボードにコピーするボタンを追加しました。

## [1.1.6] - 2026-02-16

### 変更
- **User ID廃止 (UI)**: 投稿フォーム、一覧カード、詳細画面からユーザーID (User ID) の表示を完全に削除しました。
- **匿名追跡機能**: ユーザーIDの入力欄を廃止し、代わりにブラウザごとのユニークID (Client ID) をバックグラウンドで自動生成して記録するように変更しました。これにより、画面上の匿名性を保ちつつ、管理上の追跡性を確保します。

## [1.1.5] - 2026-02-16

### 追加
- **ヘッダーリンク**: タイトルバーに README.md と CHANGELOG.md へのリンクアイコンを追加。

### 修正
- **画像読み込み**: 新規投稿時、`_thumbnail.jpg` の読み込みに失敗した場合、自動的に `.png` 形式での再取得を試みるフォールバック機能を追加。一部のURLでプレビューが表示されない問題を改善。

## [1.1.4] - 2026-02-16

### 修正
- **プロンプト表示バグの修正**: 「More / 全文」をクリックした際、カードのレイアウト制限（Transform等）の影響を受けずに正しく全画面モーダルが表示されるよう、React Portalを使用する方式に変更。
- **コード品質向上**: `ShareInput.tsx` における TypeScriptのエラー（引数不整合）を修正。更新・削除の判定ロジックをより堅牢なものに変更。

## [1.1.3] - 2026-02-16

### 修正
- **UI調整**: 投稿フォーム（ShareInput）のプレビュー画像がモバイル表示時に巨大になりすぎる問題を修正（最大幅を制限）。

## [1.1.2] - 2026-02-16

### 修正
- **データ互換性の向上**: 古いデータ（`.png`形式の画像URL）を編集しようとした際、プレビューで強制的に `_thumbnail.jpg` 形式に変換して読み込むように修正。

## [1.1.1] - 2026-02-16

### 修正
- **削除・更新処理の厳格化**: SupabaseのRLS（Row Level Security）等により処理が拒否された場合、正しくエラーを表示するように修正。
- **利用ガイドの更新**: 投稿の編集・削除方法（URL再入力による編集モード移行）についての説明を利用規約セクションに追加。

## [1.1.0] - 2026-02-16

### 追加
- **投稿編集・削除機能 (Open Edit/Delete)**:
  - 既存の投稿URLを入力した場合、自動的に「編集モード」へ移行するように変更。
  - プロンプトやユーザーIDの「Update / 更新」が可能に。
  - 「Delete / 削除」ボタンにより、投稿の削除も可能に。
  - ※ログイン不要で誰でも編集可能なWikiスタイルを採用。

## [1.0.5] - 2026-02-15

### 修正
- **画像読み込み不具合の修正**:
  - `VideoCard.tsx` でサムネイルURLが二重に生成されるバグ (`_thumbnail_thumbnail.jpg`) を修正。
  - `ShareInput.tsx` および `VideoCard.tsx` の画像読み込みに `referrerPolicy="no-referrer"` を追加し、ブラウザによる403エラーを回避。

## [1.0.4] - 2026-02-15

### 修正
- **投稿制限の緩和**: サムネイル画像プレビューが失敗した場合でも、エラー扱いとせず「プレビュー不可」の警告表示にとどめ、投稿自体は可能に変更。

## [1.0.3] - 2026-02-15

### 修正
- **全文表示機能の実装漏れ修正**: `VideoCard.tsx` に未実装だった「More / 全文」ボタンおよびオーバーレイ表示ロジックを追加。

## [1.0.2] - 2026-02-15

### 修正
- **コンパイルエラーの修正**: `ShareInput.tsx` における重複した変数宣言を削除し、ビルドエラーを解消。

## [1.0.1] - 2026-02-15

### 修正
- **利用規約の文言適正化**: 誤解を招く恐れのある表現を削除し、一般的な免責事項へ修正。
- **ページネーションのバグ修正**: 正常に動作していなかった追加読み込み処理を修正し、Load Moreボタンを有効化。
- **バージョン表記の追加**: タイトルバーに現在のバージョン番号 (v1.0.1) を表示するように変更。

## [1.0.0] - 2026-02-15

### 追加・変更
- **UIの日本語・英語併記対応**: ヘッダー、投稿フォーム、利用規約などを日英併記に変更。
- **利用規約の明記**: Monsnodeを参考に、特に児童ポルノ等の違法投稿に対する警告文を追加。
- **ページネーション機能**: 
  - トップページで一度に読み込む件数を24件に制限し、パフォーマンスを向上。
  - 「Load More / もっと読み込む」ボタンによる追加読み込み機能を実装。
- **全件検索機能**: 
  - 検索ロジックをクライアント側からサーバー側（Supabase）へ移行。
  - 読み込まれていない過去の投稿も含めた全件検索が可能に。
- **画像のみポストの非対応化**:
  - サムネイル生成ができない画像のみのポストに対し、エラーメッセージを表示し投稿ボタンを無効化。
  - ユーザーをGrokの元ページへ誘導するリンクを表示。
- **プロンプト全文表示**: 
  - 長文プロンプトの場合、「More / 全文」ボタンで全文を確認できるオーバーレイ機能を追加。
- **GitHub Pages対応**: 
  - クライアントサイドでのURL解析・サムネイル生成ロジックへの完全移行。
  - GitHub Actionsによる自動デプロイ環境の整備。

## [0.1.0] - 2026-02-14

### 追加
- プロジェクトの初期設定 (Next.js, Tailwind CSS, SQLite)。
- Grok URLからのメタデータ取得機能 (Playwright使用)。
- 動画プレビュー付きの投稿一覧表示機能。
- プロンプトテキストによる検索機能。
- URL共有・投稿機能。
- 基本的なレスポンシブデザインとダークモード。
